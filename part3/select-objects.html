
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="A workshop for creating an AI-infused photo booth application using Node-RED and TensorFlow.js" name="description"/>
<link href="https://knolleary.github.io/node-red-workshop-photobooth/part3/select-objects.html" rel="canonical"/>
<meta content="Nick O'Leary" name="author"/>
<link href="../assets/images/favicon.png" rel="shortcut icon"/>
<meta content="mkdocs-1.1.2, mkdocs-material-6.1.6" name="generator"/>
<title>Selecting objects to display - Node-RED AI Photo Booth Workshop</title>
<link href="../assets/stylesheets/main.6910b76c.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.196e0c26.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&amp;display=fallback" rel="stylesheet"/>
<style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
<link href="../css/extra.css" rel="stylesheet"/>
<link href="../css/pdf-print.css" rel="stylesheet"/>
</head>
<body data-md-color-accent="none" data-md-color-primary="none" data-md-color-scheme="" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#selecting-objects-to-display">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header-nav md-grid">
<a aria-label="Node-RED AI Photo Booth Workshop" class="md-header-nav__button md-logo" href="https://knolleary.github.io/node-red-workshop-photobooth/" title="Node-RED AI Photo Booth Workshop">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 3L1 9l11 6 9-4.91V17h2V9M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82z"></path></svg>
</a>
<label class="md-header-nav__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header-nav__title" data-md-component="header-title">
<div class="md-header-nav__ellipsis">
<span class="md-header-nav__topic md-ellipsis">
            Node-RED AI Photo Booth Workshop
          </span>
<span class="md-header-nav__topic md-ellipsis">
            
              Selecting objects to display
            
          </span>
</div>
</div>
<label class="md-header-nav__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" data-md-state="active" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</label>
<button aria-label="Clear" class="md-search__icon md-icon" data-md-component="search-reset" tabindex="-1" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>
</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header-nav__source">
<a class="md-source" href="https://github.com/knolleary/node-red-workshop-photobooth/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</div>
<div class="md-source__repository">
    knolleary/node-red-workshop-photobooth
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Node-RED AI Photo Booth Workshop" class="md-nav__button md-logo" href="https://knolleary.github.io/node-red-workshop-photobooth/" title="Node-RED AI Photo Booth Workshop">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 3L1 9l11 6 9-4.91V17h2V9M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82z"></path></svg>
</a>
    Node-RED AI Photo Booth Workshop
  </label>
<div class="md-nav__source">
<a class="md-source" href="https://github.com/knolleary/node-red-workshop-photobooth/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</div>
<div class="md-source__repository">
    knolleary/node-red-workshop-photobooth
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../index.html">
      Introduction
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" id="nav-2" type="checkbox"/>
<label class="md-nav__link" for="nav-2">
      1 - Node-RED
      <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="1 - Node-RED" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="nav-2">
<span class="md-nav__icon md-icon"></span>
        1 - Node-RED
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../part1/index.html">
      Introduction
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../part1/install.html">
      Install Node-RED
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../part1/projects.html">
      Enabling Projects
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../part1/installing-nodes.html">
      Installing Nodes
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../part1/create-flow.html">
      Creating a Flow
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../part1/commit-changes.html">
      Committing Changes
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" id="nav-3" type="checkbox"/>
<label class="md-nav__link" for="nav-3">
      2 - Node-RED Dashboard
      <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="2 - Node-RED Dashboard" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="nav-3">
<span class="md-nav__icon md-icon"></span>
        2 - Node-RED Dashboard
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../part2/index.html">
      Introduction
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../part2/create-dashboard.html">
      Create a dashboard
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../part2/adding-controls.html">
      Adding controls
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="nav-4" id="nav-4" type="checkbox"/>
<label class="md-nav__link" for="nav-4">
      3 - TensorFlow
      <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="3 - TensorFlow" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="nav-4">
<span class="md-nav__icon md-icon"></span>
        3 - TensorFlow
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="index.html">
      Introduction
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="adding-tf.html">
      TensorFlow in Node-RED
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="display-objects.html">
      Displaying detected objects
    </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
        Selecting objects to display
        <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="select-objects.html">
      Selecting objects to display
    </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#making-the-table-selectable">
    Making the table selectable
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#annotating-the-image">
    Annotating the image
  </a>
<nav aria-label="Annotating the image" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#storing-the-image">
    Storing the image
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#creating-the-annotations">
    Creating the annotations
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#next-steps">
    Next Steps
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" id="nav-5" type="checkbox"/>
<label class="md-nav__link" for="nav-5">
      4 - Containerization
      <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="4 - Containerization" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="nav-5">
<span class="md-nav__icon md-icon"></span>
        4 - Containerization
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../part4/index.html">
      Introduction
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../part4/package.html">
      Package file
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../part4/settings.html">
      Settings file
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../part4/dockerfile.html">
      Dockerfile
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../part4/one-more-thing.html">
      Finishing the project
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../part5/index.html">
      5 - Summary
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../resources.html">
      Resources
    </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#making-the-table-selectable">
    Making the table selectable
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#annotating-the-image">
    Annotating the image
  </a>
<nav aria-label="Annotating the image" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#storing-the-image">
    Storing the image
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#creating-the-annotations">
    Creating the annotations
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#next-steps">
    Next Steps
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/knolleary/node-red-workshop-photobooth/edit/main/docs/part3/select-objects.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"></path></svg>
</a>
<h1 id="selecting-objects-to-display">Selecting objects to display<a class="headerlink" href="#selecting-objects-to-display" title="Permanent link">¶</a></h1>
<p>So far we have a flow that lets you take photo and then display all of the detected
objects in it.</p>
<p>In this part of the workshop we're going to change the flow to let the user select
which object to highlight in the displayed image.</p>
<p>Before we do that, we need to rearrange the nodes to make some space for what
we'll be adding in this section.</p>
<p>Here is what we have so far:</p>
<p><img alt="" src="../images/flow-table.png"/></p>
<p>With a bit of moving around we can get to the following:</p>
<p><img alt="" src="../images/flow-tidy.png"/></p>
<p>The main addition is the pair of Link nodes - a Link In node wired to the input of
the webcam node, and a Link Out node wired to the output of the <code>move msg.image</code>
Change node. Link nodes allow you to create virtual wires that only get shown
when you select a link node at either end. This can help reduce some of the
visual complexity of a flow.</p>
<div class="admonition note">
<p class="admonition-title">Wiring Link nodes</p>
<p>You can wire Link nodes together in two ways. One way is to double click on
a Link node to open its edit dialog. Then select which nodes it should be
connected to from the list shown. The nodes are listed by their name or id.
It is always worth naming your link nodes to help you identify them in the list.
This method can be used to join link nodes that are on different tabs in the editor.</p>
<p>The other way of connecting a pair of link nodes is to first select a node
to reveal its 'virual port' and then drag a wire from that port to
another link node just as you would wire regular nodes.</p>
</div>
<h2 id="making-the-table-selectable">Making the table selectable<a class="headerlink" href="#making-the-table-selectable" title="Permanent link">¶</a></h2>
<p>We need a way for the user to select the object to display and then
regenerate the annotated image with just the selected object.</p>
<p>The <code>ui_table</code> we added in the last step can be used to select the object.</p>
<ol>
<li>
<p>Edit the table node and enable the 'Send data on click' option.</p>
<p>The table node should now have an output port.</p>
</li>
<li>
<p>Add a Debug node and wire it to the table node output.</p>
</li>
</ol>
<p><img alt="" src="../images/flow-table-debug.png"/></p>
<p>Now when you select an object in the dashboard table you will see a message
arrive in the Debug sidebar with the object's information. It will look something like:</p>
<pre><code>{
    "class": "person",
    "score": 64.49049711227417,
    "bbox": [
        5.880241394042969,
        49.79872226715088,
        517.5165557861328,
        429.3963575363159
    ],
    "id": 0
}
</code></pre>
<h2 id="annotating-the-image">Annotating the image<a class="headerlink" href="#annotating-the-image" title="Permanent link">¶</a></h2>
<p>The TensorFlow node we are using generates the image with all detected objects
annotated. It doesn't provide a way to retrospectively generate the image
with only a particular object highlighted.</p>
<p>To do that we can use another module: <a href="https://flows.nodered.org/node/node-red-node-annotate-image">node-red-node-annotate-image</a>.</p>
<p>This module can be installed from the Manage Palette option in the editor, or by
running the following command in <code>~/.node-red</code>:</p>
<pre><code>npm install node-red-node-annotate-image
</code></pre>
<p>Once installed, you will find a node called <code>annotate-image</code> in the Utility category
of the palette.</p>
<ol>
<li>Add a new <code>annotate-image</code> node into your workspace.</li>
<li>If you've added the Link nodes like we did at the start of this section:<ol>
<li>Wire the output of the <code>annotate-image</code> node to the add a new Link Out node</li>
<li>Link the new Link Out node to the Link In node connected to the webcam node.</li>
</ol>
</li>
<li>If you haven't added the Link nodes, wire the output of the <code>annotate-image</code> node
   directly to the input of the <code>ui_webcam</code> node.</li>
</ol>
<p><img alt="" src="../images/flow-annotate-link.png"/></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In this screenshot, the virtual wire is show because the Link Out node is
selected.</p>
</div>
<p>The next task is to take the output of the <code>ui_table</code> node when an object is clicked
and get it into the right format required by the <code>annotate-image</code> node.</p>
<p>The annotate node expects two properties to be set on the message it is sent:
 - <code>msg.payload</code> should be a Buffer containing the image in JPEG format
 - <code>msg.annotations</code> should be an array of the annotations it should apply to the image.</p>
<h3 id="storing-the-image">Storing the image<a class="headerlink" href="#storing-the-image" title="Permanent link">¶</a></h3>
<p>In order to annotate the image, we need a copy of the image to work on. The flow
we're working on is triggered when the user clicks on a row in the <code>ui_table</code>. This
happens as a new event - it isn't tied to original event that captured the image.</p>
<p>This means we need some way to get ahold of the original image in this new flow. We
can use Context to do that.</p>
<div class="admonition information">
<p class="admonition-title">Introducing "Context"</p>
<p>"Context" is a way to store information in Node-RED that is not tied to individual
messages passing through the flow. For example, it can be used to store global state
that needs to be shared amongst flows.</p>
<p>For more information about context, read the <a href="https://nodered.org/docs/user-guide/context" target="blank">documentation</a>.</p>
</div>
<p>The first task is to store the image in context whenever a photo is taken.</p>
<ol>
<li>Add a Change node in between the <code>ui_webcam</code> and <code>tf coco ssd</code> nodes.</li>
<li>Configure the node to set <code>flow.image</code> to the value of <code>msg.payload</code>.</li>
</ol>
<p><img alt="" src="../images/flow-webcam-change-tf.png" style="width: 300px"/></p>
<p>The next task is to retrieve that image and add it to the messages coming from
the <code>ui_table</code> node.</p>
<ol>
<li>Add a Change node and wire in between the output of the <code>ui_table</code> node and the <code>annotate-image</code> node.</li>
<li>Configure the node to set <code>msg.payload</code> to the value of <code>flow.image</code> - this is essentially
   the reverse of the operation done in the previous task.</li>
</ol>
<p><img alt="" src="../images/flow-table-change-annotate.png" style="width: 400px"/></p>
<h3 id="creating-the-annotations">Creating the annotations<a class="headerlink" href="#creating-the-annotations" title="Permanent link">¶</a></h3>
<p>As shown earlier, the payload coming from the <code>ui_table</code> node looks like this:</p>
<pre><code>{
    "class": "person",
    "score": 64.49049711227417,
    "bbox": [
        5.880241394042969,
        49.79872226715088,
        517.5165557861328,
        429.3963575363159
    ],
    "id": 0
}
</code></pre>
<p>In order draw that as an annotation on the image, the annotation node expects
<code>msg.annotations</code> to be a array containing an object like this:</p>
<pre><code>[
    {
        "label": "person",
        "bbox": [
            5.880241394042969,
            49.79872226715088,
            517.5165557861328,
            429.3963575363159
        ]
    }
]
</code></pre>
<p>You can see they are very similar, but some work is needed to map between them.</p>
<ol>
<li>Edit the Change node added in the previous step (between the <code>ui_table</code> and <code>annotate-image</code> nodes)</li>
<li>Add a new rule, and then <strong>drag it to the top of the list of rules</strong>. This is
   important because the new rule will use the information in <code>msg.payload</code>
   so needs to be applied <em>before</em> the rule that overwrites <code>msg.payload</code> with the image data.</li>
<li>Configure the new rule to set <code>msg.annotations</code> to the <em>expression</em> type and set
   the expression to:<pre><code>$append([],payload.{"label": class, "bbox": bbox})
</code></pre>
<p>This will create an array of annotations with just the <code>label</code> and <code>bbox</code> properties
   set from the original object.</p>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Testing JSONata Expressions</p>
<p>Node-RED provides an editor for JSONata expressions with the ability to
test the expression whilst working on it.</p>
<ol>
<li>
<p>Click on the expand button next to the Expression:</p>
<p><img alt="" src="../images/jsonata-expand.png" style="width: 250px"/></p>
</li>
<li>
<p>This opens the JSONata editor. You can edit the expression in the top
      pane. In the lower pane is a Function Reference and a Test tab. Click
      on the Test tab. This shows an example message on the left and the result
      of the expression on the right.</p>
<p><img alt="" src="../images/jsonata-editor.png" style="width: 400px"/></p>
</li>
<li>
<p>Copy the example output of the annotate node from above and replace
      the <code>"hello world"</code> example payload. You should see the result update
      with shown here.</p>
<p><img alt="" src="../images/jsonata-test.png" style="width: 400px"/></p>
</li>
</ol>
</div>
<p>You should now have a flow that starts with the <code>ui_table</code> node, passes through
a <code>Change</code> node to format the message, then to an <code>annotate image</code> node and finally
to the <code>ui_webcam</code> node, possibly via a <code>Link</code> node.</p>
<p>Before deploying these changes there are couple more changes to the flow needed.
We aren't going to use the image produced by the <code>tf coco ssd</code> node anymore.</p>
<ol>
<li>Delete the <code>move msg.image</code> Change node that is connected to the output of
   the <code>tf coco ssd</code> node. If you added the Link Out node, delete that as well.</li>
<li>Edit the <code>tf coco ssd</code> node to set the Passthru option to <code>nothing</code></li>
<li>Click the Deploy button to save your changes.</li>
</ol>
<p>Now when you capture an image on the webcam, you'll see the captured image on the
dashboard without any annotations. The table below the image will list the
detected objects. Clicking on an object will update the image to highlight the
selected image.</p>
<p>This is what the final flow should look like:</p>
<p><img alt="" src="../images/flow-final.png"/></p>
<h2 id="next-steps">Next Steps<a class="headerlink" href="#next-steps" title="Permanent link">¶</a></h2>
<p>With the application complete, the next task is to <a href="../part4/">wrap it in a container</a>.</p>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav aria-label="Footer" class="md-footer-nav__inner md-grid">
<a class="md-footer-nav__link md-footer-nav__link--prev" href="display-objects.html" rel="prev">
<div class="md-footer-nav__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</div>
<div class="md-footer-nav__title">
<div class="md-ellipsis">
<span class="md-footer-nav__direction">
                  Previous
                </span>
                Displaying detected objects
              </div>
</div>
</a>
<a class="md-footer-nav__link md-footer-nav__link--next" href="../part4/index.html" rel="next">
<div class="md-footer-nav__title">
<div class="md-ellipsis">
<span class="md-footer-nav__direction">
                  Next
                </span>
                Introduction
              </div>
</div>
<div class="md-footer-nav__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"></path></svg>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
          Material for MkDocs
        </a>
 ... <a class="link--pdf-download" download href="../pdf/node-red-workshop-photobooth.pdf" title="PDF">download PDF</a></div>
</div>
</div>
</footer>
</div>
<script src="../assets/javascripts/vendor.fd16492e.min.js"></script>
<script src="../assets/javascripts/bundle.7836ba4d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
<script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
</body>
</html>